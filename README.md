# ğŸ“š Book Log

Um aplicativo Flutter moderno para gerenciar sua biblioteca pessoal de livros. Registre, organize e avalie seus livros com facilidade, sincronizando dados em tempo real com Supabase.

## ğŸ¯ Funcionalidades

- âœ… **AutenticaÃ§Ã£o Segura**: Login e cadastro com Supabase Auth
- âœ… **Gerenciamento de Livros**: Criar, editar, listar e deletar livros
- âœ… **Filtros AvanÃ§ados**: Filtre por status (lido/nÃ£o lido) e gÃªnero
- âœ… **EstatÃ­sticas**: Visualize total de livros, lidos e nÃ£o lidos
- âœ… **AvaliaÃ§Ãµes**: Avalie livros de 0 a 5 estrelas
- âœ… **Capas de Livros**: Adicione URLs de capas dos livros
- âœ… **Notas Pessoais**: Adicione notas sobre seus livros
- âœ… **SincronizaÃ§Ã£o em Tempo Real**: Dados sincronizados com Supabase
- âœ… **SeguranÃ§a**: Row Level Security (RLS) para privacidade de dados

## ğŸ—ï¸ Arquitetura

O projeto segue o padrÃ£o **Clean Architecture** com separaÃ§Ã£o clara de responsabilidades:

```plaintext
lib/
â”œâ”€â”€ main.dart                 # Ponto de entrada da aplicaÃ§Ã£o
â”œâ”€â”€ configs/
â”‚   â””â”€â”€ dependencies.dart     # InjeÃ§Ã£o de dependÃªncias (Provider)
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ repositories/         # ImplementaÃ§Ã£o de repositÃ³rios
â”‚   â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”‚   â”œâ”€â”€ auth_repository.dart
â”‚   â”‚   â”‚   â””â”€â”€ auth_repository_impl.dart
â”‚   â”‚   â””â”€â”€ book/
â”‚   â”‚       â”œâ”€â”€ book_repository.dart
â”‚   â”‚       â””â”€â”€ book_repository_impl.dart
â”‚   â””â”€â”€ services/
â”‚       â””â”€â”€ api/
â”‚           â””â”€â”€ supabase_client.dart  # Cliente Supabase centralizado
â”œâ”€â”€ domain/
â”‚   â””â”€â”€ models/
â”‚       â””â”€â”€ book_model.dart   # Modelo de dados (com Freezed)
â”œâ”€â”€ routing/
â”‚   â”œâ”€â”€ router.dart           # ConfiguraÃ§Ã£o de rotas (GoRouter)
â”‚   â””â”€â”€ routes.dart           # Constantes de rotas
â”œâ”€â”€ ui/
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”œâ”€â”€ colors.dart       # Paleta de cores
â”‚   â”‚   â””â”€â”€ theme.dart        # Tema da aplicaÃ§Ã£o
â”‚   â”œâ”€â”€ login/                # Tela de login
â”‚   â”œâ”€â”€ signup/               # Tela de cadastro
â”‚   â”œâ”€â”€ home/                 # Tela principal
â”‚   â””â”€â”€ book_form/            # FormulÃ¡rio para criar/editar livros
â””â”€â”€ utils/
    â”œâ”€â”€ command.dart          # PadrÃ£o Command para async operations
    â””â”€â”€ result.dart           # Tipo Result (Ok/Error)
```

### PadrÃµes e Conceitos

- **Clean Architecture**: SeparaÃ§Ã£o entre `data`, `domain` e `ui`
- **Repository Pattern**: AbstraÃ§Ã£o de acesso a dados
- **Provider**: Gerenciamento de estado e injeÃ§Ã£o de dependÃªncia
- **GoRouter**: NavegaÃ§Ã£o declarativa com suporte a deep linking
- **Freezed**: GeraÃ§Ã£o de cÃ³digo para modelos imutÃ¡veis
- **Command Pattern**: Encapsulamento de aÃ§Ãµes assÃ­ncronas
- **Result Type**: Tratamento robusto de erros com tipos Ok/Error

## ğŸš€ Getting Started

### PrÃ©-requisitos

- **Flutter SDK**: 3.9.2 ou superior
- **Dart**: 3.9.2 ou superior
- **Conta Supabase**: Crie uma em [supabase.com](https://supabase.com)

### 1. Configurar Supabase

#### a) Criar projeto no Supabase

1. Acesse [supabase.com](https://supabase.com) e crie uma conta
2. Crie um novo projeto
3. Copie as credenciais:
   - `SUPABASE_URL`: URL do seu projeto
   - `SUPABASE_ANON_KEY`: Chave anÃ´nima pÃºblica

#### b) Criar tabela de livros

No **SQL Editor** do Supabase, execute:

```sql
create table public.books (
  id bigint generated by default as identity not null,
  created_at timestamp with time zone not null default now(),
  title text null,
  rating smallint null,
  author text null,
  genre character varying null,
  status character varying null,
  cover_url text null,
  notes text null,
  user_id uuid not null default auth.uid (),
  constraint books_pkey primary key (id)
) TABLESPACE pg_default;
```

#### c) Configurar Row Level Security (RLS)

Execute o script SQL para proteger os dados:

```sql
ALTER TABLE public.books ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can view their own books"
ON public.books FOR SELECT
USING (auth.uid() = user_id);

CREATE POLICY "Users can insert their own books"
ON public.books FOR INSERT
WITH CHECK (auth.uid() = user_id);

CREATE POLICY "Users can update their own books"
ON public.books FOR UPDATE
USING (auth.uid() = user_id)
WITH CHECK (auth.uid() = user_id);

CREATE POLICY "Users can delete their own books"
ON public.books FOR DELETE
USING (auth.uid() = user_id);
```

### 2. Configurar VariÃ¡veis de Ambiente

- Crie um arquivo `.env` na raiz do projeto:

```bash
SUPABASE_URL=https://seu-projeto.supabase.co
SUPABASE_ANON_KEY=sua-chave-anonima
```

- Certifique-se de que `.env` estÃ¡ no `pubspec.yaml` como asset:

```yaml
flutter:
  uses-material-design: true
  assets:
    - .env
```

### 3. Instalar DependÃªncias

```bash
flutter pub get
```

### 4. Gerar CÃ³digo com Build Runner

O projeto utiliza `freezed` e `json_serializable` para gerar cÃ³digo:

```bash
dart run build_runner build
```

### 5. Executar a AplicaÃ§Ã£o

```bash
flutter run
```

Para escolher um dispositivo especÃ­fico:

```bash
flutter run -d <device-id>
```

## ğŸ“± NavegaÃ§Ã£o

- **`/`** - Tela inicial (Home) com lista de livros
- **`/login`** - Tela de login
- **`/signup`** - Tela de cadastro
- **`/book/new`** - Criar novo livro
- **`/book/edit`** - Editar livro (passa o livro via `extra`)

## ğŸ“Š Modelos de Dados

### BookModel

```dart
class BookModel {
  int id;                    // ID do livro (gerado pelo BD)
  String userId;             // ID do usuÃ¡rio (via RLS)
  String title;              // TÃ­tulo do livro (obrigatÃ³rio)
  String? author;            // Autor
  String? genre;             // GÃªnero
  String? status;            // 'lido' ou 'nÃ£o lido'
  int? rating;               // AvaliaÃ§Ã£o 0-5
  String? coverUrl;          // URL da capa (armazenada no Supabase Storage)
  String? notes;             // Notas pessoais
  DateTime? createdAt;       // Data de criaÃ§Ã£o
  DateTime? updatedAt;       // Data de atualizaÃ§Ã£o
}
```

## ğŸ” AutenticaÃ§Ã£o e SeguranÃ§a

### Fluxo de AutenticaÃ§Ã£o

1. **Login/Signup**: UsuÃ¡rio se autentica via Supabase Auth
2. **Token JWT**: Supabase gera um token JWT automÃ¡tico
3. **RLS Policies**: As polÃ­ticas de seguranÃ§a garantem que cada usuÃ¡rio sÃ³ acesse seus prÃ³prios livros
4. **SessionListener**: A autenticaÃ§Ã£o Ã© monitorada e o usuÃ¡rio Ã© redirecionado se logout

### Row Level Security (RLS)

O RLS protege os dados no nÃ­vel do banco de dados:

- UsuÃ¡rios sÃ³ podem **ver** seus prÃ³prios livros
- UsuÃ¡rios sÃ³ podem **inserir** livros para si mesmos
- UsuÃ¡rios sÃ³ podem **atualizar** seus prÃ³prios livros
- UsuÃ¡rios sÃ³ podem **deletar** seus prÃ³prios livros

## ğŸ“¦ DependÃªncias Principais

| Pacote | VersÃ£o | PropÃ³sito |
|--------|--------|----------|
| `supabase_flutter` | ^2.10.3 | Backend e autenticaÃ§Ã£o |
| `provider` | ^6.1.5 | Gerenciamento de estado |
| `go_router` | ^17.0.0 | NavegaÃ§Ã£o |
| `freezed` | ^3.2.3 | GeraÃ§Ã£o de modelos imutÃ¡veis |
| `json_serializable` | ^6.11.1 | SerializaÃ§Ã£o JSON |
| `logging` | ^1.1.0 | Logs estruturados |
| `flutter_dotenv` | ^6.0.0 | VariÃ¡veis de ambiente |

## ğŸ› ï¸ Desenvolvimento

### Build Runner (geraÃ§Ã£o de cÃ³digo)

Quando modificar modelos com `@freezed` ou adicionar conversÃµes JSON:

```bash
dart run build_runner build        # Build uma vez
dart run build_runner watch        # Monitorar e regenerar automaticamente
```

### Estrutura de Pastas do Projeto

- **`docs/`** - DocumentaÃ§Ã£o (banco de dados, autenticaÃ§Ã£o, etc.)
- **`android/`** - CÃ³digo nativo Android
- **`ios/`** - CÃ³digo nativo iOS
- **`lib/`** - CÃ³digo Dart principal
- **`test/`** - Testes unitÃ¡rios e de widget

## ğŸ› Troubleshooting

### Erro: "UsuÃ¡rio nÃ£o autenticado"

**Causa**: O usuÃ¡rio nÃ£o fez login antes de acessar rotas protegidas

**SoluÃ§Ã£o**: Verifique o fluxo de autenticaÃ§Ã£o em `router.dart`

### Erro: "new row violates row-level security policy"

**Causa**: As polÃ­ticas de RLS nÃ£o foram configuradas corretamente

**SoluÃ§Ã£o**: Execute o script SQL de RLS novamente (veja seÃ§Ã£o Supabase)

### Erro: "SUPABASE_URL not found"

**Causa**: O arquivo `.env` nÃ£o estÃ¡ configurado ou nÃ£o estÃ¡ sendo carregado

**SoluÃ§Ã£o**:

1. Verifique se `.env` existe na raiz do projeto
2. Verifique se `.env` estÃ¡ listado em `pubspec.yaml` sob `assets`
3. Execute `flutter pub get` novamente

### Livros nÃ£o carregam apÃ³s ediÃ§Ã£o

**Causa**: O ViewModel estava sendo recriado e perdendo estado

**SoluÃ§Ã£o**: O projeto jÃ¡ estÃ¡ corrigido com `HomeViewModel` como singleton via Provider

## ğŸ“– Exemplo de Uso

### Criar um novo livro

1. Toque no botÃ£o flutuante (`+`) na tela Home
2. Preencha os campos (tÃ­tulo Ã© obrigatÃ³rio)
3. Toque em "Salvar"
4. O livro Ã© salvo no Supabase automaticamente

### Editar um livro

1. Toque em qualquer lugar do card do livro
2. Modifique os campos desejados
3. Toque em "Salvar"
4. A home recarrega automaticamente

### Deletar um livro

1. Toque no Ã­cone de lixeira no card do livro
2. Confirme a aÃ§Ã£o no diÃ¡logo
3. O livro Ã© deletado do Supabase

### Filtrar livros

Na tela Home, use os dropdowns de filtro para:

- Filtrar por status (Lido / NÃ£o lido)
- Filtrar por gÃªnero

## ğŸ“ Contribuindo

Este Ã© um projeto acadÃªmico da PUC. Para contribuir:

1. Crie uma branch para sua feature (`git checkout -b feature/nova-funcionalidade`)
2. Commit suas mudanÃ§as (`git commit -m 'Add nova funcionalidade'`)
3. Push para a branch (`git push origin feature/nova-funcionalidade`)
4. Abra um Pull Request

## ğŸ“„ LicenÃ§a

Este projeto estÃ¡ sob licenÃ§a proprietÃ¡ria para fins acadÃªmicos.

## ğŸ‘¥ Autor

Desenvolvido como projeto acadÃªmico na **PUC**.

## ğŸ”— Recursos Ãšteis

- [Flutter Documentation](https://flutter.dev/docs)
- [Supabase Documentation](https://supabase.com/docs)
- [Provider Package](https://pub.dev/packages/provider)
- [GoRouter Documentation](https://pub.dev/packages/go_router)
- [Freezed Package](https://pub.dev/packages/freezed)

## ğŸ“ Suporte

Para dÃºvidas ou problemas:

1. Consulte a documentaÃ§Ã£o em `/docs`
2. Verifique a seÃ§Ã£o de Troubleshooting deste README
3. Revise os logs da aplicaÃ§Ã£o (usando o pacote `logging`)

---

**Ãšltima atualizaÃ§Ã£o**: Novembro 2025

A new Flutter project.

## Getting Started

This project is a starting point for a Flutter application.

A few resources to get you started if this is your first Flutter project:

- [Lab: Write your first Flutter app](https://docs.flutter.dev/get-started/codelab)
- [Cookbook: Useful Flutter samples](https://docs.flutter.dev/cookbook)

For help getting started with Flutter development, view the
[online documentation](https://docs.flutter.dev/), which offers tutorials,
samples, guidance on mobile development, and a full API reference.
